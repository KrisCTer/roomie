# application.yml cho API Gateway

server:
  port: ${SERVER_PORT:8888}

spring:
  application:
    name: ${SPRING_APPLICATION_NAME:api-gateway}
  profiles:
    active: ${SPRING_PROFILES_ACTIVE:docker}

  # Redis Configuration
  redis:
    host: ${SPRING_REDIS_HOST:redis}
    port: ${SPRING_REDIS_PORT:6379}
    password: ${SPRING_REDIS_PASSWORD:roomie123}
    timeout: 2000ms
    lettuce:
      pool:
        max-active: 8
        max-idle: 8
        min-idle: 0
        max-wait: -1ms

  # Cloud Gateway Configuration
  cloud:
    gateway:
      routes:
        # Auth Service Routes
        - id: auth-service
          uri: ${AUTH_SERVICE_URL:http://auth-service:8080}
          predicates:
            - Path=${APP_API_PREFIX:/api/v1}/auth/**
          filters:
            - StripPrefix=2

        # Profile Service Routes
        - id: profile-service
          uri: ${PROFILE_SERVICE_URL:http://profile-service:8081}
          predicates:
            - Path=${APP_API_PREFIX:/api/v1}/profiles/**
          filters:
            - StripPrefix=2

        # Notification Service Routes
        - id: notification-service
          uri: ${NOTIFICATION_SERVICE_URL:http://notification-service:8082}
          predicates:
            - Path=${APP_API_PREFIX:/api/v1}/notifications/**
          filters:
            - StripPrefix=2

        # Property Service Routes
        - id: property-service
          uri: ${PROPERTY_SERVICE_URL:http://property-service:8083}
          predicates:
            - Path=${APP_API_PREFIX:/api/v1}/properties/**
          filters:
            - StripPrefix=2

        # File Service Routes
        - id: file-service
          uri: ${FILE_SERVICE_URL:http://file-service:8084}
          predicates:
            - Path=${APP_API_PREFIX:/api/v1}/files/**
          filters:
            - StripPrefix=2

        # Chat Service Routes
        - id: chat-service
          uri: ${CHAT_SERVICE_URL:http://chat-service:8085}
          predicates:
            - Path=${APP_API_PREFIX:/api/v1}/chats/**
          filters:
            - StripPrefix=2

      # Global CORS Configuration
      globalcors:
        cors-configurations:
          '[/**]':
            allowed-origins: "*"
            allowed-methods:
              - GET
              - POST
              - PUT
              - DELETE
              - PATCH
              - OPTIONS
            allowed-headers: "*"
            allow-credentials: false
            max-age: 3600

      # Default Filters
      default-filters:
        - DedupeResponseHeader=Access-Control-Allow-Credentials Access-Control-Allow-Origin

# Eureka Client Configuration
eureka:
  client:
    service-url:
      defaultZone: ${EUREKA_CLIENT_SERVICE_URL_DEFAULTZONE:http://eureka-server:8761/eureka/}
    register-with-eureka: true
    fetch-registry: true
  instance:
    prefer-ip-address: true
    hostname: ${HOSTNAME:api-gateway}
    instance-id: ${spring.application.name}:${spring.application.instance_id:${random.value}}

# Management & Actuator Configuration
management:
  endpoints:
    web:
      exposure:
        include: ${MANAGEMENT_ENDPOINTS_WEB_EXPOSURE_INCLUDE:health,info,metrics,prometheus}
      base-path: /actuator
  endpoint:
    health:
      show-details: always
  metrics:
    export:
      prometheus:
        enabled: ${MANAGEMENT_METRICS_EXPORT_PROMETHEUS_ENABLED:true}
  health:
    redis:
      enabled: true

# Logging Configuration
logging:
  level:
    root: ${LOGGING_LEVEL_ROOT:INFO}
    org.springframework.cloud.gateway: ${LOGGING_LEVEL_ORG_SPRINGFRAMEWORK_CLOUD_GATEWAY:DEBUG}
    org.springframework.web: INFO
    com.roomie.gateway: DEBUG
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} - %msg%n"
    file: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"

# Application Configuration
app:
  api:
    prefix: ${APP_API_PREFIX:/api/v1}